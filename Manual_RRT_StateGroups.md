# 仕様詳細

## 設定方法
1. 本プラグインをプラグイン管理に追加してください。
2. プラグイン設定画面で、グループの各項目を設定します(後述)。
3. 各ステートの設定画面で`<RSGstateGroupId:xx>`を入力します。xxはステートが属すグループIDです。
4. 必要に応じて、ステートの設定画面のメモ欄に規定のノートタグをつけます。
 
## グループ設定
### name
ステートの名称です。処理には関わらないのでメモ程度に利用してください。

### type
同属ステートの打消方式です。
１キャラに複数の同属ステートを付加できない仕様になっています。
既に同属ステートが付加されていたとき、後から付加されるステートが上書するか、
無効になるか、中和されるか(どちらも無効になるか)を設定できます。
後述のrankTypeを用いる場合は、同属同ランク(同格)のステートにのみ適用されます。

#### [overwrite(上書)]
後から付加される同属ステートの付加が有効になり、既に付加されていた同属ステートは解除されます。

#### [cancel(無効)]
後から付加される同属ステートの付加は無効になり、既に付加されている同属ステートは継続します。

#### [neutaralize(中和)]
後から付加される同属ステートの付加は無効になり、既に付加されていた同属ステートも解除されます。

### rankType
ランク値による優先方式です。  
この項目では、既に同属のステートが付加されていたとき、付加されようとしているステートのランク値の高低によって、上書と無効の関係を設定できます。

#### none(優先なし)
ランク値による優先を用いません。ランク値による優先は発生せず、常に前項のtypeによって判定されます。
 
#### [higher(高ランク優先)]
付加されている同属ステートよりも高ければ、「上書」になります。  
付加されている同属ステートよりも低ければ、「無効」になります。  
付加されている同属ステートと同値であれば、typeに従います。

#### [lower(低ランク優先)]
付加されている同属ステートよりも低ければ、「上書」になります。  
付加されている同属ステートよりも高ければ、「無効」になります。  
付加されている同属ステートと同値であれば、typeに従います。

### flag
通常切替フラグです。切替の条件です。  
ステートの設定画面のステート解除条件と対応しています。  
各項目が有効でも無効でも動作するものと、無効なら動作しないものがありますので注意してください。
基本的には解除条件は有効にすることをお勧めします。  
同じ種類のフラグは１つしか用いることができませんが、異なる種類のフラグ(xFlag,sFlag)と共存できます。     

#### [none(なし)]
このフラグを用いません。

#### [battleEnd(戦闘終了時)]
戦闘終了時に切り替わります。有効でも無効でも動作します。

#### [restrict(行動制約)]
行動制約時に切り替わります。有効でも無効でも動作します。

#### [turns(継続ターン)]
継続ターン数によって切り替わります。  
自動解除のタイミングが「なし」の場合は動作しませんので、「行動終了時」または「ターン終了時」のどちらかに設定してください。

#### [damage(歩数)]
ダメージを受けたことによって切り替わります。  
有効でも無効でも動作します。  
「ダメージによる解除確率」に従います。

#### [steps(歩数)]
歩数によって切り替わります。  
無効なら動作しません(ステートの歩数カウンタが動作しないため)。

### xFlag
拡張切替フラグです。  
属する各ステートのノートタグ<RSGxRate:xx>が、切り替え発生確率の判定に用いられます。  
その記述がない、あるいは有効な値がない場合は、必ず切り替えが発生することになります。

#### [none(なし)]
このフラグを用いません。

#### [remove(解除時)]
ステート解除時に切り替わります。  
ただし、同グループの「上書」による解除や、別ステートへの「切替」による解除には反応しません。  
相殺グループの付加による解除には反応します。
 
#### [battleStart(戦闘開始)]
戦闘開始時に切り替わります。

#### [firstAction(初回行動時)]
そのターンの初回行動時、厳密にはその直前に切り替わります。

#### [allActionsEnd(全行動終了時)]
そのターンの全ての行動が終わった後に切り替わります。

#### [turnEnd]
そのターンの全キャラクターの行動が終わった後に切り替わります。

### sFlag/sValue
特殊切替フラグです。  
sValueに有効な値が入力されていない場合は、sFlagは作動しません。  
属する各ステートのノートタグ<RSGsRate:xx>が、切替の発生確率の判定に用いられます。  
その記述がない、あるいは有効な値がない場合は、必ず切り替えが発生することになります。  
sFlagを用いるには、その種類によってそれぞれのsValueを設定する必要があります。  
この項目を[param]や[rateOfHMT]にした場合、targetの動作が他のものと異なることになります。

#### [none(なし)]
このフラグを用いません。

#### [addedState(付加ステート)]
sValueにステートのIDを半角数字で記入してください。  
そのステートが付加された直後に切り替えが発生します。  
「切替による付加」には反応しませんが、「属性攻撃による付加」には反応します。

#### [addedStateGroup(付加ステートグループ)]
sValueにステートグループIDを設定して下さい。  
そのグループに属すステートが付加された直後に切り替えが発生します。
「切替による付加」には反応しませんが、「属性攻撃による付加」には反応します。

#### [damagedElement(属性ダメージ)]
sValueに属性IDを半角数字で記入して下さい。  
その属性でダメージを受けた直後に切り替えが発生します。

#### [usingSkill(使用スキル)]
sValueには、スキルIDを半角数字で記入して下さい。  
そのスキルのコストを消費する直前に切り替えが発生します。

#### [usingSkillType(使用スキルタイプ)]
sValueには、スキルタイプIDを半角数字で記述して下さい。  
スキルの成功に関わらず、そのタイプに属すスキルのコストを消費する直前に切り替えが発生します。

#### [param(能力値)]
属するステートに「有効範囲」が発生するフラグです。  
有効範囲の値(下限と上限)には属するステートのランク値が用いられます。  
詳しくは、後述の「ランク値について」をお読みください。  
sValueには、能力値のID(＝アルファベットの略称)を記述して下さい。  
指定した能力値が有効範囲に達すれば、「切替」が発生します。

targetの項目が[rankDown]または[rankUp]の場合、
下限に達すれば[rankDown]と同じ動作、上限に達すれば[rankUp]と同じ動作になります。  
targetの項目が[random]や[none]であれば解除されることになります。  
このフラグを持つグループに属するステートを付加されようとしたとき、有効範囲に合ったステートが自動的に付加されることになります。  
この場合、ノートタグ`<RSGsRate:xx>`の記入は無視されます。

#### [rateOfHMT(HP/MP/TPの残存割合)]
属するステートに「有効範囲」が発生するフラグです。  
sValueには hp mp tp のいずれかを記述して下さい。  
残存値の最大値に対する割合によって切り替えが発生します。  
それ以外は[param]と同様です。

### target
切替先となるステートを設定します。  
flag、xFlag、sFlagで設定したそれぞれの条件が満たされたときに、この設定に従って切り替わります。  
target[state]の場合は、各ステートのノートタグ`<RSGtargetState:xx>`で設定したステートへ切り替わることになります。

「切替」の作動機序としては基本的に、  
      1.元のステートが解除(削除)される  
      2.切替先ステートが付加される  
という機序で動きます。  
ただしこの時の「解除」および「付加」は、
	* xFlagの[remove]
	* sFlagの[addedState]
	* [addedStateGroup]
を動作させることはありません。

#### [none]
何も起こらないか、sFlagに有効範囲がある場合、解除されます。

#### [rankUp]
同じグループの中でランク値が次に大きいステートに切り替わります。
次に高いステートがない場合は何も起こりません。
sflagに有効範囲がある場合は、rankUpもrankDownも変わりません。
ただしrankType[none]の場合、rankUpとrankDownで有効範囲が異なります。
詳しくは後述の「ランク値について」を参照して下さい。

#### [rankDown]
同じグループの中でランク値が次に大きいステートに切り替わります。
次に低いステートがない場合は何も起こりません。

#### [random]
同じグループのランダムなステートに切り替わります。  
sFlagに有効範囲がある場合は、単に解除されます。

#### [state]
ノートタグ`<RSGtargetState:xx>`で指定したステートに切り替わります。  
ノートタグに有効な値が記入されていない場合は切り替えが起こりません。

### element/eRate
グループに属性を関連付けます。デフォルトはどちらも0で、この状態だと何も起こりません。  
属性によるダメージを受けると、それに関連づけられたグループの中で、「最も適したステート」が付加されます。  
eRateでその付加確率を設定できます。  
属性によるステートの「付加」は、他のステートのsFlag[addedState]および[addedStateGroup]を動作させます。  
属性ダメージによる実際の付加確率は、eRate * [ステート耐性率] * [運による補正率] です。  
* target[rankUp]の場合：最もランク値の低いものが付加されます。
* target[rankDown]の場合：最もランク値の高いものが付加されます。
* targetがそれ以外の場合で、
	* rankType[higher]の場合：最もランク値の低いものが付加されます。
	* rankType[lower]の場合：最もランク値の高いものが付加されます。
	* rankTyoeがそれ以外の場合、グループの中からランダムに選ばれます。
なお、sFlagに有効範囲がある場合は、自動的に有効範囲に合うステートが付加されます。

### counter
このグループに属するステートを相殺するグループ(相殺グループ)を設定できます。  
デフォルトは０で、この状態だと何も起こりません。  
なんらかのステートを付加しようとしたとき、そのステートの相殺グループに属するステートが既に付加されていれば、
そのステートの付加は無効になり、相殺グループに属するステートも解除されることになります。
type[neutral]と似たような挙動になりますが、「中和」はxFlag[remove]を動作させないのに対し、「相殺」はxFlag[remove]を動作させます。

相殺グループの設定にもcounterを設定することで、両者のグループが同時に共存することはなくなります。  

## ランク値について
<RSGrank:xx>により設定するランク値は、以下の２点の用途のために用いられます。

### 【ランク値による同属ステートに対する上書と無効】
ノートタグでランク値が設定されていない場合、「優先度」で入力されている値がランク値として処理に用いられます。  
ランク値を必要としないグループである場合は必要ありません。

### 【sFlagに有効範囲がある場合のランク値の利用】
sFlag[param]および[rateOfHMT]の場合、ランク値の数値そのものが判定に大きく関わってきます。
切替の判定で用いる値の有効範囲について、その上限値と下限値を決めるため、ランク値の数値を転用することになります。
各ステートの上限値と下限値の決定方法は、以下のような仕様になっています。
* rankTypeが[higher]の場合：
	* 上限値：次に高いステートのランク値・次に高いステートがない場合は無限大
	* 下限値：そのステートのランク値・次に低いステートがない場合は無限小
	* 下限値 ≦ 有効範囲 < 上限値
* rankTypeが[lower]の場合：
	* 上限値：そのステートのランク値・次に高いステートがない場合は無限大
	* 下限値：次に低いステートの同属ランク値・次に低いステートがない場合は無限小
	*下限値 ≦ 有効範囲 < 上限値
* rankTypegが[none]の場合：
	* かつtargetが[rankUp]の場合：
		* 上限値：次に高い同属ステートのランク値・次に高いステートがない場合は無限大
		* 下限値：そのステートのランク値・次に低いステートがない場合は無限小
		* 下限値　≦ 有効範囲　< 上限値
	* かつtargetが[rankDown]の場合：
		* 上限値：そのステートのランク値・次に高いステートがない場合は無限大
		* 下限値：次に低いステートの同属ランク値・次に低いステートがない場合は無限小
		* 下限値　≦ 有効範囲　< 上限値
 	* かつtargetが[none]あるいは[state]の場合：
		* 上限値：次に高い同属ステートのランク値・次に高いステートがない場合は無限大
 		* 下限値：次に低いステートの同属ランク値・次に低いステートがない場合は無限小
 		* 下限値<有効範囲<上限値

## ステートのノートタグ
各ステートにノートタグをつける

### `<RSGgroupId:xx>`(半角数字)
グループのID番号を設定します。ステートは１つのグループにのみ属せます。

### `<RSGrank:xx>`(半角数字)
ステートのグループ内でのランク値を設定します。  
この記述がない場合、ステートの「優先度」がランク値として用いられます。

### `<RSGxRate:xx>`(半角)
拡張フラグ(xFlag)によるステート切り替えの作動確率です。
この記述がない場合、xFlagは必ず作動します。

### `<RSGsRate:xx>`
特殊フラグ(sFlag)によるステート切り替えの作動確率です。

### `<RSGtargetState:xx>`
target[state]のグループに属する場合は設定して下さい。
設定しない場合、切り替えが作動しません。

## グループ数の拡張
10個以上のグループが必要な場合はEXTENSIONの項で追加してください。
EXTENSIONで設定した各グループのIDは、行番号に10を足したものになります。
